<!DOCTYPE html>
<html lang="ru">
<head>
    <title>Карта</title>
</head>
<body>

<script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU"></script>
<script src="qrc:///qtwebchannel/qwebchannel.js"></script>
<script>
var ymap;

var map_type;
var map_data;

var polygon_cords = []

function helloWorld() {
	alert('Hello world');
	return 'OK';
}

new QWebChannel(qt.webChannelTransport, async function (channel) {
	backend = await channel.objects.backend;
	init(backend);
});

function initYMap() {
	ymap = new ymaps.Map ('app', {
		center: [55.75, 37.61],
		zoom: 12
	});

	draw_polygon();
};

async function init(backend) {
	ymaps.ready(initYMap);

	map_js = await backend.get_map();
	[map_type, map_data] = await JSON.parse(map_js);
};

function draw_polygon() {
	alert('draw polygon');

	ymap.events.add('click', leftClick_fixMark);
	ymap.events.add('contextmenu', rightClick_fixPolygon);
};

const leftClick_fixMark = function (event) {
	cords = event.get('coords');
	polygon_cords.push(cords);

	let placemark = new ymaps.Placemark(cords);
	ymap.geoObjects.add(placemark);
};

const rightClick_fixPolygon = function (event) {
	alert('right click');
	let polygon = new ymaps.Polygon([polygon_cords,[]]);
	ymap.geoObjects.add(polygon);
};
</script>

<div id="app" style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;">
</div>
</body>
</html>
