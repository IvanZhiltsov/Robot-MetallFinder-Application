## Robot-MetallFinder-Application
Приложение для связи с роботом-металлоискателем

# Описание робота
Робот на 6-ти колёсах с автономным управлением, предназначен для поиска металла на заданной территории. Робот самостоятельно прочёсывает зону поиска, выбирая оптимальную траекторию. Места с найденным металлом помечаются в памяти робота, поэтому после завершения работы можно получить координаты этих мест. Задать роботу область поиска и получить с него собранные данные можно с помощью данного приложения

Робот имеет 3 режима: *рабочий режим*, *работа окончена* и *режим ожидания*
1. - Чтобы начать работу, робота нужно доставить в необходимое место, включить питание и нажать соответствующую кнопку *старт* на роботе
   - Чтобы робот смог выполнить задание по поиску металла, он должен быть переведён в *рабочий режим* с загруженной областью поиска, иначе робот подаст соответствующий сигнал
2. - После завершения работы робот автоматически переводится в режим *работа окончена*
   - Только в таком режиме можно получить данные с робота
3. - В *режиме ожидания* робот ждёт следующего подключения к компьютеру и получения новых инструкций

# Описание приложения
1. Приложение позволяет установить связь с роботом через Bluetooth, чтобы передать ему необходимую область поиска или получить информацию о найденных местах с металлом
2. Приложение отображает текущее состояние робота: заряд батареи, исправность модулей, готовность к работе и прочее
3. Приложение позволяет смоделировать необходимую область поиска, отобразить её на карте в удобном для человека формате и сохранить в виде набора координат
4. Приложение позволяет отобразить на карте или сохранить в виде набора координат данные, полученные роботом

# Техническое задание
Приложение имеет 2 основные вкладки - *карта* и *робот*, расположенные на центральном виджете TabWidget

Также приложение имеет разделы *Файл* и *О программе* на панели меню

**Вкладка *карта***
1. - Имеет виджет *QWebEngineView* для отображения карты реальной местности
   - На виджете располагается html код с использованием *JS APY Яндекс Карт* для загрузки карты с серверов компании *Яндекс*
   - Также с помощью JavaScript создаются дополнительные графические объекты для отображения данных на карте
2. - Имеет возможность рисовать полигон на карте - область поиска
   - Такая карта имеет тип *область* и может быть загружена в робота
   - Для этого имеются кнопки переключения режимов: *курсор*, *полигон*, *удалить полигон*, создать точку *финиша* робота и *отмена/возврат* действий (по умолчанию - *курсор*)
   - Кнопки расположены над картой
   - Если действие недоступно, то недоступно и нажатие на кнопку
3. Режим *полигон*:
   - Полигон рисуется добавлением точек (вершин): новая вершина соединяется линией с предыдущей и показывает пунктиром соединение с первоначальной, тем самым замыкая полигон и показывая конечную область
   - Левой кнопкой мыши фиксируются точки, при фиксации точки автоматически добавляется следующая вершина полигона
   - Правой кнопкой мыши завершается создание полигона (последняя не фиксированная точка не добавляется), после чего режим сменяется на *курсор*
   
   Ограничения:
   - завершить создание полигона можно только, если в нём более 2 вершин, иначе действие приведёт к удалению созданных объектов и переходу в режим *курсор*
   - зафиксировать точку можно только, если полигон будет удовлетворять условиям, описанным ниже, иначе действие приведёт к редактированию предыдущей вершины
   
4. Режим *финиш*:
   - Задаёт конечное положение робота после завершения его работы
   - Левой кнопкой мыши фиксируется точка, режим сменяется на *курсор*
   - Правой кнопкой мыши отменяется создание точки, режим сменяется на *курсор*
   
   Ограничение: создать точку можно только после создания полигона, если она попадает в его область, иначе действие вернёт в режим *курсор*

5. Режим *курсор*:
   - Зажав левую кнопку мыши на вершине созданного полигона или точке *финиша*, можно передвигать её
   - Зажав левую кнопку мыши на пустом пространстве, можно передвигаться по карте
   - Щёлкнув правой кнопкой мыши по ребру полигона, можно добавить новую вершину на ребре в месте клика
   - Щёлкнув правой кнопкой мыши по вершине полигона, можно удалить её (удаляются 2 выходящих из неё ребра, а 2 соседние вершины соединяются новым ребром)
   - Щёлкнув правой кнопкой мыши по точке *финиша*, можно удалить её
   
   На действие накладываются все вышеизложенные ограничения, которые отменяют его, кроме:
   - если после удаления точки осталось 2 вершины, удаляются все объекты
   - если после перемещения вершины точка *финиша* вышла за область, то она удаляется

6. - Режим *удалить полигон* удаляет весь полигон, если он был создан, позволяя рисовать новый
   - Режимы *отмена/возврат* действий отменяет или возвращает действие соответственно

7. Условие создания полигона:
   - отсутствует пересечение или совпадение рёбер
   - длина рёбер и угол между ними находятся в рамках некоторых критических значений, которые учитывают размеры робота и погрешность при его перемещении

8. Каждый тип объекта имеет свой цвет, внутренняя область полигона штрихуется, при нарушении ограничений, объекты с ошибкой подсвечиваются
9. - При загрузке данных с робота, они отображаются на карте
   - Такая карта представляет собой отдельный тип *данные*, которую нельзя редактировать или загрузить в робота
   - Поэтому сверху карты скрываются все кнопки
   - На карте показывается область поиска и найденные места с металлом
   - Если металл не был обнаружен, то выводится соответствующее сообщение в Статус-Баре
10. - Карту можно открыть с памяти компьютера и, если тип карты позволяет, редактировать или загрузить в робота
    - Новые карты также можно сохранять
    - Если текущая карта не сохранена, то при попытке открыть другую карту или загрузить её с робота всплывёт предупреждающее окно
    - Пустую карту сохранить нельзя

**Вкладка *робот***
1. Имеет *панель связи* для установки соединения с роботом по Bluetooth и справа от него *окно состояния* робота
2. Если изначально компьютер не подключён к роботу, то отображается *список доступных устройств*, а *панель связи* и *окно состояния* скрыты
   - Отображаются имена устройств. При клике на них выполняется подключение к соответствующему роботу
   - Если подключенное устройство не является роботом-металлоискателем, то выводится соответствующее сообщение в Статус-Баре, а подключение отменяется
3. Если изначально к компьютеру подключён не робот (например наушники), то отключение такого устройства не происходит
4. Таким образом, через настройки Bluetooth компьютера можно подключить любое устройство, но через приложение - только робота-металлоискателя
5. Если устройство успешно подключено к роботу, то отображаются *панель связи* и *окно состояния*, а *список доступных устройств* скрывается
6. *Панель связи*:
   - Имеет кнопки: *отключиться*, *загрузить карту*, *получить данные* и *очистить память*
   - Кнопка *отключиться* отменяет подключение к роботу, сохранив в его памяти прежние данные, инструкции и режим
   - Кнопка *загрузить карту* открывает диалоговое окно для загрузки области поиска в память робота и перевода его в *рабочий режим*
   - Кнопка *получить данные* загружает в приложение данные из памяти робота и отображает их на карте. Можно получить только в режиме робота *работа окончена*, иначе выводится соответствующее сообщение в Статус-Баре, а загрузка отменяется
   - Кнопка *очистить память* удаляет из памяти робота все данные и инструкции и переводит его в *режим ожидания*
7. *Окно загрузки карты:*
   - Имеет кнопки *открыть карту* и *загрузить текущую карту*
   - Кнопка *открыть карту* открывает диалоговое окно для выбора карты с памяти компьютера
   - Кнопка *загрузить текущую карту* выбирает текущую карту, отображённую во вкладке *карта*
   - Выбранная карта сначала загружается в приложение, для дальнейшей проверки
   - Если загруженная карта имеет ошибку или тип *данные*, то выводится соответствующее сообщение в Статус-Баре, а загрузка отменяется
   - После загрузки отображается имя карты, а также появляется кнопка *Отправить инструкцию*
   - Если текущего заряда робота не хватает на выполнение работы, то выводится соответствующее предупреждение в Статус-Баре и дублируется перед окончательной отправкой роботу инструкций
   - Карту можно выбрать заново, если загруженная не подходит
   - Чтобы загрузить выбранную карту в память робота, нужно нажать кнопку *Отправить инструкцию*, после чего роботу отправится карта и у него установится *рабочий режим*. В конце окно загрузки закроется
8. *Окно состояния робота*:
   - Отображает текущий режим
   - Отображает текущий заряд с помощью Прогресс-Бара
   - При режиме *работа окончена* дополнительно отображаются реальные время и заряд, потраченные роботом на выполнение работы, а также количество найденных мест с металлом, если они есть

**Раздел *Файл***
1. Предназначен для открытия/сохранения карты
2. - В памяти компьютера и робота храниться только набор координат (вершины полигона, точка *финиша* и найденные места с металлом), а также тип карты
   - Набор координат сохраняется в виде текстового файла
   - Все преобразования для отображения данных на карте происходят в приложении
   - Все преобразования для проектирования необходимой траектории производятся роботом
3. Имеет подменю: *Открыть*, *Сохранить*, *Сохранить как* и *Загрузить* в робота
4. Подменю *Открыть*:
   - Открывает диалоговое окно для выбора файла с памяти компьютера
   - Загружает в приложение карту
   - Если выбранный файл не является картой или возникли другие ошибки, то выводится соответствующее сообщение в Статус-Баре, а загрузка отменяется
   - Загруженная карта отображается в соответствующей вкладке
5. Подменю *Сохранить* - перезаписывает карту, если она была сохранена, иначе открывает диалоговое окно для сохранения карты в память компьютера
6. Подменю *Сохранить как* - открывает диалоговое окно для сохранения карты в память компьютера
7. Подменю *Загрузить*:
   - Открывает*окно загрузки карты* и загружает в него текущую карту
   - Если компьютер не подключен к роботу-металлоискателю, то выводится соответствующее сообщение в Статус-Баре, а загрузка отменяется

**Раздел *О программе***
1. Содержит подменю: *GitHub*, *Yandex Map API* и др.
2. Подменю переводит пользователя в браузер на соответствующую страничку в интернете для получения информации о приложении и сторонних ресурсах, используемых в нём

## Пояснительная записка
Было разработано приложение, позволяющее пользователю на карте указывать роботу-металлоискателю область для поиска в автоматическом режиме, а также просматривать на карте полученные от робота координаты точек, в которых был обнаружен металл

Ссылка на папку с готовой программой в Яндекс Диске:
https://disk.yandex.ru/d/iXoZDTNDujEJNA
