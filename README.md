## Robot-MetallFinder-Application
Приложение для связи с роботом-металлоискателем

# Описание робота
Робот на 6-ти колёсах с автономным управлением, предназначен для поиска металла на заданной территории. Робот самостоятельно прочёсывает зону поиска, выбирая оптимальную траекторию. Места с найденным металлом помечаются в памяти робота, поэтому после завершения работы можно получить координаты этих мест. Задать роботу область поиска и получить с него собранные данные можно с помощью этого приложения

Робот имеет 2 режима: *рабочий режим* и *режим ожидания*
1. - Чтобы начать работу, робота нужно доставить в необходимое место, включить питание и нажать соответствующую кнопку *старт* на роботе
   - Чтобы робот смог выполнить задание по поиску металла, он должен быть переведён в *рабочий режим* с загруженной областью поиска, иначе робот подаст соответствующий сигнал
2. - После завершения работы робот автоматически переводится в *режим ожидания*
   - В *режиме ожидания* робот ждёт следующего подключения к компьютеру и получения новых инструкций

# Описание приложения
1. Приложение позволяет устанавить сявзь с роботом через Bluetooth, чтобы передать ему необходимую область поиска или получить информациию о найденных местах с металлом
2. Приложение отображает текущее состояние робота: заряд батареи, исправность модулей, готовность к работе и прочее
3. Приложение позволяет смоделировать необходимую область поиска, отобразить её на карте в удобном для человека фрмате и сохранить в виде набора координат
4. Приложение позволяет отобразить на карте или сохранить в виде набора координат данные, полученные роботом

# Техническое задание
Приложение имеет 2 основные вкладки - *карта* и *робот*

**Вкладка *карта***
1. - Имеет виджет *QWebEngineView* для отображеиня карты реальной местности
   - На виджите распологается html код с использованием *JS APY Яндекс Карт* для загрузки карты с серверов компании *Яндекс*
   - Также с помощью JavaScript отображаются дополнительные графические объекты для отображеия данных на карте
2. - Имеет возможность рисовать полигон на карте - область поиска
   - Такая карта имеет тип **область** и может быть загружена в робота
   - Для этого имеются кнопки переключения режимов: *курсор* и *полигон*, *удалить полигон*, создать точку *финиша* робота и *отмена/возврат* действий (по умолчанию - *курсор*)
   - Кнопки расположены над картой и имеют свои иконки
   - При длительном наведении на кнопку отображается название её режима или операции
   - Если действие недоступно, то недостпно и нажатие на кнопку
   - Выбранный режим подсвечивается
3. Режим *полигон*:
   - Полигон рисуется добавлением точек (вершин): новая вершина соединяется линией с предыдущей и показывает пунктиром соединение с первоначальной, тем самым замыкая полигон и показывая конечную область
   - Левой кнопкой мыши фиксируются точки, при фиксации точки автоматически добавляется следующая вершина полигона
   - Правой кнопкой мыши завершается создание полигона (последняя не фиксированная точка не добавляется), после чего режим сменяется на *курсор*
   
   Ограничения:
   - завершить создание полигона можно только, если в нём более 2 вершин, иначе действие приведёт к удалению созданных объектов и переходу в режим *курсор*
   - зафиксировать точку можно только, если полигон будет удовлетворять условиям, описанным ниже, иначе действие приведёт к редактированию предыдущей вершины
   
4. Режим *финиш*:
   - Задаёт конечное положение робота после завершения его работы
   - Точка привязывается к границе полигона, если находятся в близи неё
   - Левой кнопкой мыши фиксируется точка, режим сменяется на *курсор*
   - Правой кнопкой мыши отменяется создание точки, режим сменяется на *курсор*
   
   Ограничение: создать точку можно только после создания полигона, если она попадает в его область, иначе действие вернёт в режим *курсор*

5. Режим *курсор*:
   - Зажав левую кнопку мыши на вершине созданного полигона или точке *финиша*, можно передвигать её
   - Зажав левую кнопку мыши на пустом пространстве, можно передвигаться по карте
   - Щёленув правой кнопкой мыши по ребру полигона, можно добавить новую вершину на ребре в месте клика или создать/удалить точку *финиша*
   - Щёлкнув правой кнопкой мыши по вершине полигона, можно удалить её (удаляются 2 выходящих из неё ребра, а 2 соседнии вершины соединяются новым ребром) или создать/удалить точку *финиша*
   - Щёлкнув правой кнопкой мыши по точке *финиша*, можно удалить её
   
   На действие накладываются все выше изложенные ограничения, которые отменяют его, кроме:
   - если после удаления точки осталось 2 вершины, удаляются все объекты
   - если после перемещения вершины точка *финиша* вышла за область, то она удаляется

6. - Режим *удалить полигон* удаляет весь полигон, если он был создан, позволяя рисовать новый**   
   - Режимы *отмена/возврат* действий отменяет или возвращает действие соответственно**

7. Условие создания полигона:
   - отсутствует пересечение или совпадение рёбер
   - длина ребра и угол между ними находятся в рамках некоторых критических значений, кторые учитывают размеры робота и погрешность при его перемещении

8. Каждый тип объекта имеет свой цвет, внутренняя область полигона штрихуется, при нарушении ограничений, объекты с ошибкой подсвечиваются
9. - При загрузке данных с робота, они отображаются на карте
   - Такая карта представляет собой отдельный тип **данные**, которую нельзя редактировать или загрузить в робота
   - На карте показывается область поиска, траектория движения робота и найденные места с металлом
   - При сохранении карты можно оставить только найденные места, без изначальной области поиска и траектории робота
10. - Карту можно открыть с памяти устройства и, если тип карты позволяет, редактировать или загрузить в робота
    - Новые карты также можно сохранять
    - Если текущая карта не сохранена, то при попытке открыть другую карту или загрузить её с робота всплывёт предупреждающее окно

**Вкладка *робот***
1. Имеет *панель связи* для устанвки соединения с роботом по Bluetooth и справа от него *окно состояния* робота
2. Если изначально устройство не подключено к роботу, то отображается *список доступных устройств*, а *панель связи* и *окно состояния* скрыты
   - Отображаются имена устройства, кликнув по которым выполняется подклучение к роботу
   - Если подключенное устройство не является роботом-металлоискателем, то выводится соответствующее сообщение в Статус-Баре, а подключение отменяется
3. Если изначально к устройству подключён не робот (например наушники), то отключене не происходит
4. Если устройство успешно подключено к роботу, то отображаются *панель связи* и *окно состояния*, а *список доступных устройств* скрывается
5. *Панель связи* имеет кнопки: *отключиться*, *загрузить карту*, *получить данные* и *очистить память*
   - Кнопка *отключиться* отменяет подключение
   - Кнопка *загрузить карту* открывает диалоговое окно для загрузки области поиска в память робота и перевода его в *рабочий режим*
   - Кнопка *получить данные* загружает в приложение данные из памяти робота и отображает их на карте. Если данных нет - то выводится соответствующее сообщение в Статус-Баре, а загрузка отменяется
   - Кнопка *очистить память* удаляет из памяи робота все данные и инсрукции и переводит его в *режим ожидания*
